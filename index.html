<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Title -->
        <title>Eashan's KHS Model</title>
        
    </head>
    <body>
        
        <h1>Eashan's KHS Model</h1>
        
        <script type="module">
            
            import * as THREE from 'https://raw.githubusercontent.com/mrdoob/three.js/master/build/three.module.js';
            import { GLTFLoader } from './js/GLTFLoader.js';
            import { RGBELoader } from './js/RGBELoader.js';
            import { OrbitControls } from './js/OrbitControls.js';
            
            var container, controls;
            var camera, scene, renderer;
            
            init();
            render();
            
            function init() {
                container = document.createElement('div');
                document.body.appendChild(container);
                
                camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.25, 20);
                camera.position.set(-1.8, 0.6, 2.7);
                
                scene = new THREE.Scene();
                
                new RGBELoader()
                    .setDataType(THREE.UnsignedByteType)
                    .setPath('model/')
                    .load('hdr.hdr', function (texture) {
                        var envMap = pmremGenerator.fromEquirectangular(texture).texture;

                        scene.background = envMap;
                        scene.environment = envMap;

                        texture.dispose();
                        pmremGenerator.dispose();

                        render();

                        var loader = new GLTFLoader().setPath('model/');
                        loader.load('model.glb', function (gltf) {
                            scene.add(gltf.scene);
                            render();
                        });
                    });
                
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1;
                renderer.outputEncoding = THREE.sRGBEncoding;
                container.appendChild(renderer.domElement);
                
                var pmremGenerator = new THREE.PMREMGenerator(renderer);
                pmremGenerator.compileEquirectangularShader();
                
                controls = new OrbitControls(camera, renderer.domElement);
                controls.addEventListener('change', render);
                controls.minDistance = 2;
                controls.maxDistance = 10;
                controls.target.set(0, 0, -0.2);
                controls.update();
                
                window.addEventListener('resize', onWindowResize, false);
            }
            
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix;
                renderer.setSize(window.innerWidth, window.innerHeight);
                render();
            }
            
            function render() {
                renderer.render(scene, camera);
            }
            
        </script>
        
    </body>
</html>